# ğŸ“„ Caffe-in ë°°í¬

### Frontend
React 17.0.2,  react-bootstrap 2.1.0, style-component 5.3.3, web-vitals 2.1.3

### Backend
IntelliJ, SpringBoot 2.5.6, Gradle 7.3.2

### DB / EC2
MySQL 8.0.28, Redis 5.0.7  
Ubuntu 20.04, Nginx 1.18.0, Jenkins 2.319.2  

## â­ AWS EC2 í•„ìˆ˜ ì„¤ì¹˜ í•­ëª©
- Nginx 1.18.0
- openjdk version "11.0.13â€
- MySQL 8.0.28
- Redis 5.0.7

## ğŸ“Œ ë°°í¬(ë¹Œë“œ) ì‹œ íŠ¹ì´ì‚¬í•­
ì™¸ë¶€ ì„œë¹„ìŠ¤ API Key ë° DB ì ‘ì† ì •ë³´ê°€ í¬í•¨ëœ application.yaml íŒŒì¼ì´ .gitignore ì— ë“±ë¡ë˜ì–´ git ì›ê²© ì €ì¥ì†Œì—ì„œ ì œì™¸ë¨  
ë°±ì—”ë“œ Spring Boot í”„ë¡œì íŠ¸ ë¹Œë“œ ë˜ëŠ” ì  í‚¨ìŠ¤ ìë™ ë°°í¬ ì‹œ application.yaml íŒŒì¼ì„ í”„ë¡œì íŠ¸ì˜ src/main/resources ê²½ë¡œì— í¬í•¨í•´ì•¼ í•¨

`/src/main/resources/application.yaml`
<details>
<summary>application.yaml</summary>
<div markdown="1">

```yaml
server:
  port: 8080
  servlet:
    context-path:

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://i6c104.p.ssafy.io:3306/caffe_in?serverTimezone=Asia/Seoul
    username: {username}
    password: {password}
  jpa:
    open-in-view: false
    #    hibernate:
    #      ddl-auto: create
    properties:
      hibernate:
        format_sql: true
        show-sql: true
  mail:
    host: smtp.gmail.com
    port: 587
    username: {google email}
    password: {password}
    properties:
      mail:
        smtp:
          auth: true
          starttls:
            enable: true
  redis:
    lettuce:
      pool:
        min-idle: 0
        max-idle: 8
        max-active: 8
    port: 6379
    host: i6c104.p.ssafy.io
    password: {password}
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

logging.level.com.kql.caffein: debug

jwt:
  header: Authorization
  secret: {secret}

api:
  kakao:
    kakaoApiKey : {kakaoApiKey}
    redirectURI : {redirectURI}

  google:
    clientId : {clientId}
    redirectURI: {redirectURI}
    clientSecret : {clientSecret}

  naver:
    clientId: {clientId}
    clientSecret: {clientSecret}
    redirectURI: {redirectURI}
    state: {state}

cloud:
  aws:
    credentials:
      accessKey: {accessKey}
      secretKey: {secretKey}
    s3:
      bucket: {bucket}
    region:
      static: ap-northeast-2
    stack:
      auto: false

oauth:
  pass: {pass}
```

</div>
</details>



## ğŸ’» ìˆ˜ë™ ë°°í¬
### í”„ë¡ íŠ¸ ë¹Œë“œ íŒŒì¼ ìœ„ì¹˜ ì„¤ì •

`/etc/nginx/sites-available/default`ì˜ rootì— í”„ë¡ íŠ¸ ë¹Œë“œ íŒŒì¼ ê²½ë¡œ ì‘ì„±

```
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /home/ubuntu/build;

        # Add index.php to the list if you are using PHP
        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                # First attempt to serve request as file, then
                # as directory, then fall back to displaying a 404.
                #try_files $uri $uri/ =404;
                try_files $uri $uri/ /index.html;
        }
}
```

### ë°±ì—”ë“œ jar ì‹¤í–‰

```bash
$ java -jar caffe_in.jar
# nohup java -jar caffe_in.jar &
```

## âš™ Jenkins CI/CD ìë™ ë°°í¬
### npm & Jenkins ì„¤ì¹˜

```bash
$ curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash --
$ sudo apt-get install -y nodejs

$ node -v # v14.19.0
$ npm -v # 6.14.16
```

```bash
$ wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -
$ sudo sh -c 'echo deb https://pkg.jenkins.io/debian-stable binary/ > \
    /etc/apt/sources.list.d/jenkins.list'
$ sudo apt-get update
$ sudo apt-get install jenkins

# systemctl status jenkins ë˜ëŠ” service jenkins statusë¡œ ìƒíƒœ í™•ì¸
```

### Jenkins í¬íŠ¸ ë³€ê²½ (8080â†’8090)

`/ect/init.d/jenkins`

![image](https://user-images.githubusercontent.com/50658153/154447924-d22019ff-d808-4605-9bee-2ec731f796b9.png)

`/etc/default/jenkins`

![image](https://user-images.githubusercontent.com/50658153/154448000-dfdfa3e9-4b5b-48e5-8530-31ad5198f1a4.png)

```bash
$ service jenkins restart
# systemctl restart jenkins
```

### Jenkins ì„¤ì •

[ì°¸ê³  ë§í¬](https://velog.io/@kido/EC2Jenkins-CICD-%EC%9E%90%EB%8F%99%EB%B0%B0%ED%8F%AC)

### í”„ë¡ íŠ¸ ë¹Œë“œ íŒŒì¼ ìœ„ì¹˜ ë³€ê²½

`/etc/nginx/sites-available/default`

```
# react build í´ë”ë¡œ root ê²½ë¡œ ë³€ê²½
root /var/lib/jenkins/workspace/caffe_in/frontend/build;
```

### Jenkins Build Execute Shell
![image](https://user-images.githubusercontent.com/50658153/154451501-adf7e817-8036-4ae0-8122-f25ff10ccf91.png)

## DB ì ‘ì† ì •ë³´
- MySQL
  - port : 3306
  - username : kqlab64
  - password : ssafyi6c104caffein
- Redis
  - host : i6c104.p.ssafy.io
  - port : 6379
  - password: ssafyi6c104kql
